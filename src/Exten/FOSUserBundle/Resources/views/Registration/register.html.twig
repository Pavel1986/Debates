{% block fos_user_content_register %}
    
<div id="RegForm">    
    {% trans_default_domain 'FOSUserBundle' %}
        
    <div id="RegErrors">
        
    </div>
    
        <script type="text/javascript">

        $(document).ready(function(){           
            
            
            $("#RegForm").dialog({
                autoOpen: false,
                modal: true,
                width: 330,
                buttons: {
                    "Create": function() {

                        var check_result = UserModule.CheckRegFields(name_length, password_length);

                        if(check_result){

                            var password = MD5($('#password_first').val());

                            Socket.emit('Registration', {'Email' : $("#RegForm").find('#email').val(), 'Password' : password, 'Name' : $('#name').val()});

                        }
                    }
                }
            });
            
            $('.fos_user_registration_register ._reset').click(function() {
                $("#RegForm").find('#email').val("");
                $('#password_first').val("");
                $('#password_second').val("");
                $('#name').val("");                       
            });
        
            $('.fos_user_registration_register._close').click(function() {
                $("#RegForm").dialog( "close" );                       
            });
        
            $(".fos_user_registration_register").submit( function(event){
                
                event.preventDefault();
                $.ajax({
                    type        : $('form').attr( 'method' ),
                    url         : '{{ path('exten_fos_user_register_check') }}',
                    data        : $('.fos_user_registration_register').serialize(),
                    dataType    : "json",
                    success     : function(data, status, object) {
                        if(data.success == false){
                                $('#RegErrors').html(data.message);           
                        } else if(data.success == true){
                            window.location.replace(data.url);
                        };
                    },
                    error: function(data, status, object){
                        console.log(data.message);
                    }
                });
            });  
            
            $('#RegisterBtn').click(function(ev){
                $("#RegForm").dialog("open");
            });

            $("#RegisterBtn").button();
    
        });
        
    </script>
   
    <form method="post" class="fos_user_registration_register">              
        
        <div id="fos_user_registration_form">
            <div>
                <label for="fos_user_registration_form_email" class="required">{{ 'form.email'|trans }}</label>
                <input type="email" id="fos_user_registration_form_email" name="fos_user_registration_form[email]" required="required" />
            </div>
            <div>
                <label for="fos_user_registration_form_username" class="required">{{ 'form.username'|trans }}</label>
                <input type="text" id="fos_user_registration_form_username" name="fos_user_registration_form[username]" required="required" pattern=".{2,}" />
            </div>
            <div>
                <label for="fos_user_registration_form_plainPassword_first" class="required">{{ 'form.password'|trans }}</label>
                <input type="password" id="fos_user_registration_form_plainPassword_first" name="fos_user_registration_form[plainPassword][first]" required="required" />
            </div>
            <div>
                <label for="fos_user_registration_form_plainPassword_second" class="required">{{ 'form.password_confirmation'|trans }}</label>
                <input type="password" id="fos_user_registration_form_plainPassword_second" name="fos_user_registration_form[plainPassword][second]" required="required" />
            </div>                  
            <div>
                {{ form_row(form._token) }}                
            </div>
                    <br />
        <hr />
        <input type="submit" class="_submit" name="_submit" value="{{ 'registration.submit'|trans }}" />
        <input type="button" class="_reset" value="{{ 'security.login.reset'|trans }}" />
        <input type="button" class="_close" value="{{ 'security.login.close'|trans }}" />
        </div>
    </form>           

</div>       
            
{% endblock fos_user_content_register %}
